{
  "module": "llm",
  "description": "LLM service, model selection, token tracking, tool registry, prompt building",
  "status": "complete",
  "components": {
    "tool_handlers": {
      "status": "complete",
      "implementation": "ToolHandlerBinder (10 handlers), Handler delegate on LopenToolDefinition, BindHandler on IToolRegistry",
      "tests": "ToolHandlerBinderTests (22 unit tests) + ToolBindingIntegrationTests (8 integration tests: 1 structural + 7 behavioral)",
      "jobs": [
        "JOB-003",
        "JOB-013"
      ],
      "notes": "JOB-013: Added behavioral integration tests proving all 7 managed tools are functional (LLM-05). Tests invoke handlers through registry after BindAll() and verify correct output/side-effects."
    },
    "oracle_verifier_wiring": {
      "status": "complete",
      "implementation": "IOracleVerifier wired into ToolHandlerBinder. Verify handlers call VerifyAsync() with evidence/criteria. Auto-pass fallback when oracle unavailable.",
      "tests": "ToolHandlerBinderTests (12 new: oracle dispatch pass/fail, fallback, end-to-end with update_task_status)",
      "jobs": [
        "JOB-082"
      ],
      "notes": "LLM-06 met. DI registration updated in ServiceCollectionExtensions.cs."
    },
    "sdk_tool_registration": {
      "status": "complete",
      "implementation": "ToolConversion static class in Lopen.Llm converts LopenToolDefinition â†’ AIFunction via AIFunctionFactory.Create. CopilotLlmService sets SessionConfig.Tools before session creation.",
      "tests": "ToolConversionTests (11 tests)",
      "jobs": [
        "JOB-002"
      ],
      "notes": "CORE-25: Filters null handlers. Maps name/description. Wraps handler delegate for SDK compatibility. Microsoft.Extensions.AI.Abstractions added as explicit dependency."
    },
    "model_fallback": {
      "status": "complete",
      "spec_ref": "LLM-11",
      "files": [
        "RetryingLlmService.cs",
        "LlmException.cs",
        "DefaultModelSelector.cs"
      ],
      "tests": "RetryingLlmServiceTests (19 tests)",
      "notes": "Decorator wraps CopilotLlmService. Per-phase fallback chains in ModelOptions. IsModelUnavailable flag on LlmException with heuristic detection."
    },
    "token_metrics_persistence": {
      "status": "complete",
      "spec_ref": "LLM-13",
      "files": [
        "ITokenTracker.cs",
        "InMemoryTokenTracker.cs",
        "WorkflowOrchestrator.cs"
      ],
      "tests": "InMemoryTokenTrackerTests (16 total, 4 new for prior-iteration restore/round-trip)",
      "notes": "RestoreMetrics on resume ensures cumulative values monotonically increase across sessions. RestoreMetrics now accepts optional priorIterations to preserve per-iteration history across sessions (STOR-03)."
    },
    "tool-per-phase": {
      "status": "complete",
      "tasks": {
        "add-comprehensive-per-phase-tests": "complete"
      }
    },
    "stub-cleanup": {
      "status": "complete",
      "tasks": {
        "remove-stub-llm-service": "complete"
      }
    },
    "auth_token_bridge": {
      "status": "complete",
      "spec_ref": "LLM-01",
      "files": [
        "AuthBridgeTokenProvider.cs",
        "Program.cs"
      ],
      "tests": "AuthBridgeTokenProviderTests (4 tests) + ProgramTests DI_ResolvesGitHubTokenProvider_AsAuthBridge",
      "notes": "Bridges ITokenSourceResolver (Auth) to IGitHubTokenProvider (LLM). Registered before AddLopenLlm() in composition root."
    },
    "session_state_saver_bridge": {
      "status": "complete",
      "spec_ref": "CORE-23",
      "files": [
        "SessionStateSaverBridge.cs",
        "Program.cs"
      ],
      "tests": "SessionStateSaverBridgeTests (5 tests) + ProgramTests DI_ResolvesSessionStateSaver_AsBridge",
      "notes": "Bridges ISessionManager (Storage) to ISessionStateSaver (LLM). Conditionally registered when projectRoot is non-null. AuthErrorHandler can now persist session state before aborting."
    }
  },
  "last_updated": "2026-02-17T22:45:00Z"
}
